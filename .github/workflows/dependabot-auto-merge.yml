name: Dependabot Auto Merge

on:
  pull_request:
    types: [opened, synchronize, reopened]

jobs:
  automerge:
    if: github.actor == 'dependabot[bot]'
    runs-on: ubuntu-latest
    permissions:
      contents: write
      pull-requests: write
    steps:
      - name: Enable auto-merge for patch updates
        uses: actions/github-script@v7
        with:
          script: |
            const pr = context.payload.pull_request;
            if (!pr) return;
            const title = pr.title || '';
            const isPatch = /from [^\s]+ to [^\s]+$/.test(title) && !title.includes('major') && !title.includes('minor');
            if (!isPatch) {
              core.info('Not a patch update PR title pattern; skipping auto-merge.');
              return;
            }
            await github.graphql(`
              mutation($pullRequestId: ID!) {
                enablePullRequestAutoMerge(input: {pullRequestId: $pullRequestId, mergeMethod: SQUASH}) {
                  pullRequest { id }
                }
              }
            `, { pullRequestId: pr.node_id });
